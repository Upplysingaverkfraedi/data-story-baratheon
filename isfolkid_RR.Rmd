---
title: "isfolkid_R"
author: "Erlendur"
date: "2024-10-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("RSQLite")
library(RSQLite)
install.packages("dplyr")
library(dplyr)
```

```{r}
# Tengjast SQLite gagnagrunninum
library(RSQLite)
con <- dbConnect(RSQLite::SQLite(), "isfolkid.db")

# Sækja gögn um kyn og aldur
gender_age_data <- dbGetQuery(con, "
                              SELECT
                              gender, 
                              COALESCE(death, 2024) - birth AS age
                              FROM family
                              WHERE birth IS NOT NULL AND gender IS NOT NULL;
                              ")

# Sækja öll aldursgögn eftir kyni
age_data <- dbGetQuery(con, "
  SELECT gender, COALESCE(death, 2024) - birth AS age
  FROM family
  WHERE birth IS NOT NULL AND gender IS NOT NULL;
")


# Sækja aldursgögn fyrir good vs evil persónur
age_distribution_data <- dbGetQuery(con, "
  SELECT
    gender,
    COALESCE(chosen_one, 'Unknown') AS nature, 
    COALESCE(death, 2024) - birth AS age
  FROM family
  WHERE birth IS NOT NULL
  AND chosen_one IN ('good', 'evil')
  AND gender IS NOT NULL;
")

# Loka tenginu
dbDisconnect(con)
```

```{r}
library(shiny)
library(ggplot2)

# Notendaviðmót (UI)
ui <- fluidPage(
  titlePanel("Saga Ísfólksins - Aldur, kynja og eiginleiki persóna"),
  
  sidebarLayout(
    sidebarPanel(
      # Þú getur bætt við fleiri valkostum ef þörf er á
    ),
    
    mainPanel(
      plotOutput("genderAgePlot"), # Aldursdreifing eftir kyni
      plotOutput("ageData"), # Aldur eftir kyni
      plotOutput("ageDistributionPlot"), # Aldur og kyn eftir good eða evil
    )
  )
)

# Server hluti
server <- function(input, output) {
  
  # Alduredreifing eftir kyn
  output$genderAgePlot <- renderPlot({
    ggplot(gender_age_data, aes(x = age, fill = gender)) +
      geom_histogram(position = "dodge", binwidth = 5, color = "black") +
      theme_minimal() +
      labs(title = "Aldursdreifing eftir kyni", x = "Aldur", y = "Fjöldi") +
      scale_fill_manual(values = c("F" = "pink", "M" = "lightblue"), name = "Kyn")
  })
  
  # Boxplot með aldursdreifingu eftir kyni
  output$ageData <- renderPlot({
    ggplot(age_data, aes(x = gender, y = age, fill = gender)) +
      geom_boxplot() +
      theme_minimal() +
      labs(title = "Aldursdreifing eftir kyni - Boxplot", x = "Kyn", y = "Aldur") +
      scale_fill_manual(values = c("F" = "pink", "M" = "lightblue"), name = "Kyn")
  })
    
  # Aldursdreifing good vs evil (Boxplot fyrir aldursdreifingu)
    output$ageDistributionPlot <- renderPlot({
      ggplot(age_distribution_data, aes(x = nature, y = age, fill = gender)) +
        geom_boxplot() +
        theme_minimal() +
        labs(title = "Aldursdrefing good vs evil með kynjum", x = "Eiginleiki", y = "Aldur") +
        scale_fill_manual(values = c("F" = "pink", "M" = "lightblue"), name = "Kyn")
  })
  
}

# Keyra Shiny appið
shinyApp( ui = ui, server = server)
```



```{r}
# Finna hæsta og lægsta aldur fyrir konur
max_female_age <- max(age_data$age[age_data$gender == "F"], na.rm = TRUE)
min_female_age <- min(age_data$age[age_data$gender == "F"], na.rm = TRUE)

# Finna hæsta og lægsta aldur fyrir karla
max_male_age <- max(age_data$age[age_data$gender == "M"], na.rm = TRUE)
min_male_age <- min(age_data$age[age_data$gender == "M"], na.rm = TRUE)

# Birta niðurstöður
cat("Hæsti aldur kvenna:", max_female_age, "\nLægsti aldur kvenna:", min_female_age, "\n")
cat("Hæsti aldur karla:", max_male_age, "\nLægsti aldur karla:", min_male_age, "\n")

# Finna meðalaldur fyrir konur
mean_female_age <- mean(age_data$age[age_data$gender == "F"], na.rm = TRUE)

# Finna meðalaldur fyrir karla
mean_male_age <- mean(age_data$age[age_data$gender == "M"], na.rm = TRUE)

# Birta niðurstöður
cat("Meðalaldur kvenna:", mean_female_age, "\n")
cat("Meðalaldur karla:", mean_male_age, "\n")

# Finna meðalaldur fyrir "good" persónur
mean_good_age <- mean(age_distribution_data$age[age_distribution_data$nature == "good"], na.rm = TRUE)

# Finna meðalaldur fyrir "evil" persónur
mean_evil_age <- mean(age_distribution_data$age[age_distribution_data$nature == "evil"], na.rm = TRUE)

# Birta niðurstöður
cat("Meðalaldur 'good' persóna:", mean_good_age, "\n")
cat("Meðalaldur 'evil' persóna:", mean_evil_age, "\n")

# Finna meðalaldur, hæsta og lægsta aldur fyrir "good" persónur
mean_good_age <- mean(age_distribution_data$age[age_distribution_data$nature == "good"], na.rm = TRUE)
max_good_age <- max(age_distribution_data$age[age_distribution_data$nature == "good"], na.rm = TRUE)
min_good_age <- min(age_distribution_data$age[age_distribution_data$nature == "good"], na.rm = TRUE)

# Finna meðalaldur, hæsta og lægsta aldur fyrir "evil" persónur
mean_evil_age <- mean(age_distribution_data$age[age_distribution_data$nature == "evil"], na.rm = TRUE)
max_evil_age <- max(age_distribution_data$age[age_distribution_data$nature == "evil"], na.rm = TRUE)
min_evil_age <- min(age_distribution_data$age[age_distribution_data$nature == "evil"], na.rm = TRUE)

# Birta niðurstöður fyrir "good"
cat("Meðalaldur 'good' persóna:", mean_good_age, "\n")
cat("Hæsti aldur 'good' persóna:", max_good_age, "\n")
cat("Lægsti aldur 'good' persóna:", min_good_age, "\n")

# Birta niðurstöður fyrir "evil"
cat("Meðalaldur 'evil' persóna:", mean_evil_age, "\n")
cat("Hæsti aldur 'evil' persóna:", max_evil_age, "\n")
cat("Lægsti aldur 'evil' persóna:", min_evil_age, "\n")



```